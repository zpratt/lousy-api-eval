openapi: 3.1.0
info:
  title: Vehicle Quoting API
  description: >
    Automotive dealership vehicle quoting system. Sales staff configure and price
    vehicle quotes for customers, including option compatibility enforcement,
    package pricing, and manufacturer incentive programs.
  version: 1.0.0

  contact:
    name: API Support
    email: api-support@example.com
servers:
- url: https://localhost:3000
  description: Local development server

  x-internal: true
tags:
- name: Vehicles
  description: Vehicle models and trim levels
- name: Options
  description: Vehicle options and option categories
- name: Quotes
  description: Quote creation, configuration, pricing, and lifecycle
- name: Incentive Programs
  description: Manufacturer incentive programs, rules, and benefits

paths:
  # ── Vehicles ────────────────────────────────────────────────────────────────

  /vehicles:
    post:
      operationId: createVehicle
      tags: [Vehicles]
      summary: Create a vehicle model
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateVehicleRequest"
      responses:
        "201":
          description: Vehicle created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vehicle"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
      description: Registers a new vehicle model (make, model, year) in the system with its destination charge.
    get:
      operationId: listVehicles
      tags: [Vehicles]
      summary: List all vehicle models
      responses:
        "200":
          description: List of vehicles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Vehicle"

                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all registered vehicle models. Use this to browse the available model lineup.
  /vehicles/{id}:
    get:
      operationId: getVehicle
      tags: [Vehicles]
      summary: Get a vehicle model by ID
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Vehicle details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Vehicle"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Retrieves a single vehicle model by its unique identifier, including the destination charge.
  /vehicles/{vehicleId}/trims:
    post:
      operationId: createTrim
      tags: [Vehicles]
      summary: Create a trim level for a vehicle
      parameters:
      - $ref: "#/components/parameters/VehicleId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTrimRequest"
      responses:
        "201":
          description: Trim created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Trim"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
      description: Creates a new trim level for the specified vehicle model with a name, numeric level, and base MSRP.
    get:
      operationId: listTrims
      tags: [Vehicles]
      summary: List trim levels for a vehicle
      parameters:
      - $ref: "#/components/parameters/VehicleId"
      responses:
        "200":
          description: List of trims
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Trim"
                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

  # ── Options ─────────────────────────────────────────────────────────────────

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all trim levels defined for the specified vehicle model, ordered by level.
  /option-categories:
    post:
      operationId: createOptionCategory
      tags: [Options]
      summary: Create an option category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOptionCategoryRequest"
      responses:
        "201":
          description: Category created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OptionCategory"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
      description: Creates a new option category for grouping related vehicle options (e.g., Technology, Appearance).
    get:
      operationId: listOptionCategories
      tags: [Options]
      summary: List all option categories
      responses:
        "200":
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OptionCategory"

                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all option categories defined in the system.
  /options:
    post:
      operationId: createOption
      tags: [Options]
      summary: Create a vehicle option
      description: >
        Create an option with optional compatibility rules. Dependencies are
        options that MUST be present when this option is selected. Exclusions
        are options that CANNOT be present when this option is selected. Trim
        restrictions limit which trim levels this option is available on.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOptionRequest"
      responses:
        "201":
          description: Option created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Option"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      operationId: listOptions
      tags: [Options]
      summary: List all options
      responses:
        "200":
          description: List of options
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Option"

                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all vehicle options including their compatibility rules, pricing type, and package 
        membership.
  /options/{id}:
    get:
      operationId: getOption
      tags: [Options]
      summary: Get an option by ID
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Option details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Option"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

  # ── Quotes ──────────────────────────────────────────────────────────────────

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Retrieves a single vehicle option by ID including its dependencies, exclusions, and trim 
        restrictions.
  /quotes:
    post:
      operationId: createQuote
      tags: [Quotes]
      summary: Create a new quote
      description: >
        Creates a quote in draft status for a specific vehicle and trim.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateQuoteRequest"
      responses:
        "201":
          description: Quote created in draft status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      operationId: listQuotes
      tags: [Quotes]
      summary: List all quotes
      responses:
        "200":
          description: List of quotes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Quote"

                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all quotes across all statuses. Each quote includes its current options and applied 
        incentives.
  /quotes/{id}:
    get:
      operationId: getQuote
      tags: [Quotes]
      summary: Get a quote by ID
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Quote details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Retrieves a single quote by ID including its status, options, applied incentives, and timestamps.
  /quotes/{id}/options:
    post:
      operationId: addQuoteOption
      tags: [Quotes]
      summary: Add an option to a quote
      description: >
        Adds an option to the quote. The system enforces compatibility rules:

        - **Dependencies**: If the option requires other options, those must
          already be on the quote. Transitive dependencies are validated
          (if C requires B and B requires A, all must be present).

        - **Exclusions**: If the option excludes another option already on the
          quote, the request is rejected.

        - **Trim restrictions**: If the option is restricted to specific trim
          levels, the quote's trim must match.

        - **Status check**: Only quotes in draft status can be modified.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddQuoteOptionRequest"
      responses:
        "201":
          description: Option added to quote
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          description: >
            Compatibility rule violation. The response body includes a specific
            error message identifying the rule that was violated.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                dependencyViolation:
                  summary: Missing dependency
                  value:
                    error: "Option \"Adaptive Cruise Control\" requires \"Forward Collision Alert\" to be added first"
                exclusionViolation:
                  summary: Exclusion conflict
                  value:
                    error: "Option \"Standard Audio\" cannot be added because it excludes \"Premium Audio System\" which is
                      already on the quote"
                trimRestriction:
                  summary: Trim restriction
                  value:
                    error: "Option \"Performance Exhaust\" is only available on specific trim levels"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Quote status does not allow modification
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notDraft:
                  summary: Quote not in draft status
                  value:
                    error: "Options can only be added to quotes in draft status"

          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /quotes/{id}/options/{optionId}:
    delete:
      operationId: removeQuoteOption
      tags: [Quotes]
      summary: Remove an option from a quote
      description: >
        Removes an option from the quote. Only quotes in draft status can be
        modified.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      - name: optionId
        in: path
        required: true
        schema:
          type: string
          maxLength: 36
          format: uuid
        description: The ID of the option to remove
      responses:
        "200":
          description: Option removed from quote
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Quote status does not allow modification
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                notDraft:
                  summary: Options can only be removed from quotes in draft status
                  value:
                    error: "Options can only be removed from quotes in draft status"

          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /quotes/{id}/calculate:
    post:
      operationId: calculateQuote
      tags: [Quotes]
      summary: Calculate or recalculate quote pricing
      description: >
        Calculates the total price of a quote:

        - **Base price**: MSRP of the selected trim level
        - **Flat options**: Added directly to the base
        - **Percentage options**: Calculated as a percentage of the base MSRP
        - **Package discounts**: Applied when ALL options in a package are
          present on the quote
        - **Destination charge**: Flat fee configured per vehicle model, added
          as a separate line item (not an option)
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Pricing calculated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuotePricing"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
  /quotes/{id}/transition:
    post:
      operationId: transitionQuoteStatus
      tags: [Quotes]
      summary: Transition quote status
      description: >
        Transitions the quote to a new status. Valid transitions:

        - `draft` → `presented`
        - `presented` → `accepted`
        - `presented` → `expired`

        Accepted quotes cannot be modified or reverted. Only draft quotes can
        have options added or removed.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransitionQuoteRequest"
      responses:
        "200":
          description: Status transitioned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidRequest:
                  summary: Missing or invalid status
                  value:
                    error: "Request body must include a valid \"status\" value"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "409":
          description: Invalid status transition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidTransition:
                  summary: Invalid transition
                  value:
                    error: "Cannot transition from \"accepted\" to \"draft\""
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

  # ── Incentive Programs ──────────────────────────────────────────────────────

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /incentive-programs:
    post:
      operationId: createIncentiveProgram
      tags: [Incentive Programs]
      summary: Create an incentive program
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateIncentiveProgramRequest"
      responses:
        "201":
          description: Program created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncentiveProgram"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
      description: Creates a new incentive program with date bounds, exclusivity setting, and an optional stacking cap.
    get:
      operationId: listIncentivePrograms
      tags: [Incentive Programs]
      summary: List all incentive programs
      responses:
        "200":
          description: List of programs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IncentiveProgram"

                maxItems: 100
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Returns all incentive programs including their rules and benefits.
  /incentive-programs/{id}:
    get:
      operationId: getIncentiveProgram
      tags: [Incentive Programs]
      summary: Get an incentive program by ID
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Program details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncentiveProgram"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
      description: Retrieves a single incentive program by ID including its eligibility rules and benefits.
  /incentive-programs/{id}/rules:
    post:
      operationId: addProgramRule
      tags: [Incentive Programs]
      summary: Add an eligibility rule to a program
      description: >
        Adds a rule that must be satisfied for a quote to qualify for this
        program. All rules on a program use AND logic — every rule must pass.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProgramRuleRequest"
      responses:
        "201":
          description: Rule added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgramRule"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /incentive-programs/{id}/benefits:
    post:
      operationId: addProgramBenefit
      tags: [Incentive Programs]
      summary: Add a benefit to a program
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProgramBenefitRequest"
      responses:
        "201":
          description: Benefit added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgramBenefit"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
      description: Adds a benefit (discount) to the program. Each program can have multiple benefits of different types.
  /quotes/{id}/evaluate-incentives:
    post:
      operationId: evaluateIncentives
      tags: [Quotes]
      summary: Evaluate incentive eligibility (what-if)
      description: >
        Evaluates which incentive programs the quote qualifies for and what
        discounts would be applied, **without mutating the quote**. Use this
        for "what-if" scenarios before committing to applying programs.

        Returns eligible programs, their computed discount amounts, and the
        projected final price after stacking rules are applied.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Eligibility evaluation results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IncentiveEvaluation"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
  /quotes/{id}/apply-incentives:
    post:
      operationId: applyIncentives
      tags: [Quotes]
      summary: Apply eligible incentive programs to a quote
      description: >
        Evaluates eligibility and applies qualifying incentive programs to the
        quote. Stacking rules are enforced:

        - **Exclusive programs**: If any exclusive program qualifies, only the
          one with the largest dollar discount is applied. No other programs
          (exclusive or non-exclusive) are applied.

        - **Non-exclusive programs**: Stack additively. When one or more
          qualifying non-exclusive programs specify a non-null `stackingCap`,
          the total discount from all non-exclusive programs is capped at the
          lowest (most restrictive) non-null cap as a percentage of the full
          pre-discount quote total (baseMsrp + sum of option prices +
          destinationCharge, before any package discounts or incentives are
          applied). If no qualifying non-exclusive program has a non-null
          `stackingCap`, no aggregate cap is applied.

        **Idempotency**: If this endpoint is called more than once on the same
        quote, previously applied incentives are replaced by the newly computed
        applied set (post-stacking). Each call performs a fresh evaluation and overwrites
        `appliedIncentives` on the quote.

        **Lifecycle constraint**: Incentives may only be applied to quotes in
        `draft` status. Attempting to apply incentives to a quote in any other
        status (`presented`, `accepted`, or `expired`) will return a `409 Conflict` error.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Incentives applied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Quote"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          description: Quote status does not allow incentive application
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalidStatus:
                  summary: Quote is not in a modifiable status
                  value:
                    error: "Incentives can only be applied to quotes in draft status"

          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
  /quotes/{id}/pricing-breakdown:
    get:
      operationId: getPricingBreakdown
      tags: [Quotes]
      summary: Get full pricing breakdown for a quote
      description: >
        Returns a fully itemized pricing breakdown including base MSRP,
        individual option prices, package discounts, destination charge,
        subtotal before incentives, each applied incentive with its name and
        discount amount, and the final price.
      parameters:
      - $ref: "#/components/parameters/ResourceId"
      responses:
        "200":
          description: Full pricing breakdown
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PricingBreakdown"
          headers:
            X-RateLimit-Limit:
              description: Maximum number of requests per time window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Remaining:
              description: Number of requests remaining in the current window
              schema:
                type: integer
                format: int32
                minimum: 0
                maximum: 1000000
            X-RateLimit-Reset:
              description: UTC epoch seconds when the current window resets
              schema:
                type: integer
                format: int64
                minimum: 0
                maximum: 9999999999
            Access-Control-Allow-Origin:
              description: Indicates which origins are allowed to access the resource
              schema:
                type: string
                maxLength: 255
                pattern: ^https?://[\w\-\.]+(:\d+)?$
        "404":
          $ref: "#/components/responses/NotFound"

        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '400':
          $ref: '#/components/responses/BadRequest'
components:
  # ── Parameters ──────────────────────────────────────────────────────────────

  parameters:
    ResourceId:
      name: id
      in: path
      required: true
      schema:
        type: string
        maxLength: 36
        format: uuid
      description: Resource identifier

    VehicleId:
      name: vehicleId
      in: path
      required: true
      schema:
        type: string
        maxLength: 36
        format: uuid
      description: Vehicle model identifier

  # ── Reusable Responses ──────────────────────────────────────────────────────

  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests per time window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Remaining:
          description: Number of requests remaining in the current window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Reset:
          description: UTC epoch seconds when the current window resets
          schema:
            type: integer
            format: int64
            minimum: 0
            maximum: 9999999999
        Access-Control-Allow-Origin:
          description: Indicates which origins are allowed to access the resource
          schema:
            type: string
            maxLength: 255
            pattern: ^https?://[\w\-\.]+(:\d+)?$
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  # ── Schemas ─────────────────────────────────────────────────────────────────

      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests per time window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Remaining:
          description: Number of requests remaining in the current window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Reset:
          description: UTC epoch seconds when the current window resets
          schema:
            type: integer
            format: int64
            minimum: 0
            maximum: 9999999999
        Access-Control-Allow-Origin:
          description: Indicates which origins are allowed to access the resource
          schema:
            type: string
            maxLength: 255
            pattern: ^https?://[\w\-\.]+(:\d+)?$
    Unauthorized:
      description: Authentication required or token invalid
      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests per time window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Remaining:
          description: Number of requests remaining in the current window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Reset:
          description: UTC epoch seconds when the current window resets
          schema:
            type: integer
            format: int64
            minimum: 0
            maximum: 9999999999
        Access-Control-Allow-Origin:
          description: Indicates which origins are allowed to access the resource
          schema:
            type: string
            maxLength: 255
            pattern: ^https?://[\w\-\.]+(:\d+)?$
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    TooManyRequests:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests per time window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Remaining:
          description: Number of requests remaining in the current window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Reset:
          description: UTC epoch seconds when the current window resets
          schema:
            type: integer
            format: int64
            minimum: 0
            maximum: 9999999999
        Retry-After:
          description: Seconds to wait before retrying
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 2147483647
        Access-Control-Allow-Origin:
          description: Indicates which origins are allowed to access the resource
          schema:
            type: string
            maxLength: 255
            pattern: ^https?://[\w\-\.]+(:\d+)?$
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
      headers:
        X-RateLimit-Limit:
          description: Maximum number of requests per time window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Remaining:
          description: Number of requests remaining in the current window
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 1000000
        X-RateLimit-Reset:
          description: UTC epoch seconds when the current window resets
          schema:
            type: integer
            format: int64
            minimum: 0
            maximum: 9999999999
        Access-Control-Allow-Origin:
          description: Indicates which origins are allowed to access the resource
          schema:
            type: string
            maxLength: 255
            pattern: ^https?://[\w\-\.]+(:\d+)?$
  schemas:
    Error:
      type: object
      required: [error]
      properties:
        error:
          type: string
          description: >
            A specific, human-readable error message describing what went wrong.
            For compatibility violations, the message must identify the specific
            rule that was violated and the options involved.

    # ── Vehicle Schemas ─────────────────────────────────────────────────────

          maxLength: 2000
          pattern: ^[\s\S]+$
    CreateVehicleRequest:
      type: object
      required: [make, model, year, destinationCharge]
      properties:
        make:
          type: string
          examples: ["Chevrolet"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        model:
          type: string
          examples: ["Malibu"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        year:
          type: integer
          examples: [2025]
          format: int32
          minimum: 0
          maximum: 2147483647
        destinationCharge:
          type: number
          format: double
          description: Flat destination charge added to every quote for this model
          examples: [1295]

    Vehicle:
      type: object
      required: [id, make, model, year, destinationCharge]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        make:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        model:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        year:
          type: integer
          format: int32
          minimum: 0
          maximum: 2147483647
        destinationCharge:
          type: number
          format: double

    CreateTrimRequest:
      type: object
      required: [name, level, msrp]
      properties:
        name:
          type: string
          description: Display name of the trim level
          examples: ["LT"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        level:
          type: integer
          description: >
            Numeric ordering of the trim within the vehicle's lineup.
            Lower numbers are base trims; higher numbers are premium.
            Used for "at or above" trim comparisons.
          examples: [2]
          format: int32
          minimum: 0
          maximum: 2147483647
        msrp:
          type: number
          format: double
          description: Base MSRP for this trim level
          examples: [28500]

    Trim:
      type: object
      required: [id, vehicleId, name, level, msrp]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        vehicleId:
          type: string
          maxLength: 36
          format: uuid
        name:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        level:
          type: integer
          format: int32
          minimum: 0
          maximum: 2147483647
        msrp:
          type: number
          format: double

    # ── Option Schemas ──────────────────────────────────────────────────────

    CreateOptionCategoryRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          examples: ["Technology"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$

    OptionCategory:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        name:
          type: string

          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
    CreateOptionRequest:
      type: object
      required: [name, categoryId, pricingType, price]
      properties:
        name:
          type: string
          examples: ["Adaptive Cruise Control"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        categoryId:
          type: string
          description: ID of the option category this belongs to
          maxLength: 36
          format: uuid
        pricingType:
          $ref: "#/components/schemas/PricingType"
        price:
          type: number
          format: double
          description: >
            For flat pricing, the dollar amount. For percentage pricing,
            the percentage value (e.g., 2.0 means 2% of base MSRP).
          examples: [1250]
        description:
          type: string
          maxLength: 2000
          pattern: ^[\s\S]+$
        dependencies:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          description: >
            IDs of options that MUST be present on the quote when this option is
            selected. Transitive dependencies are enforced: if this option
            depends on B, and B depends on A, then A must also be present.
          default: []
          maxItems: 100
        exclusions:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          description: >
            IDs of options that CANNOT be present on the quote when this option
            is selected.
          default: []
          maxItems: 100
        trimRestrictions:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          description: >
            IDs of trims this option is available on. If empty or omitted, the
            option is available on all trims. When set, the quote's trim must
            be in this list for the option to be added.
          default: []
          maxItems: 100
        packageId:
          type: ["string", "null"]
          description: >
            If this option is part of a package, the package identifier. When
            ALL options sharing the same packageId are present on a quote, the
            package discount is applied.
          maxLength: 36
          format: uuid
        packageName:
          type: ["string", "null"]
          description: >
            Human-readable name of the package this option belongs to. All
            options sharing the same packageId should use the same
            packageName. Used in the pricing breakdown to label the package
            discount line item.
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        packageDiscount:
          anyOf:
          - type: number
            format: double
          - type: "null"
          description: >
            Dollar discount applied when the full package is present. Each
            option in a package may carry its own packageDiscount value. When
            calculating the total package discount for a quote, the server
            sums all non-zero packageDiscount values across options sharing
            the same packageId. Typically only one option per package carries
            the discount (the others set this to 0 or null), but if multiple
            options specify non-zero values they are all summed.

    Option:
      type: object
      required: [id, name, categoryId, pricingType, price]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        name:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        categoryId:
          type: string
          maxLength: 36
          format: uuid
        pricingType:
          $ref: "#/components/schemas/PricingType"
        price:
          type: number
          format: double
        description:
          type: string
          maxLength: 2000
          pattern: ^[\s\S]+$
        dependencies:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          maxItems: 100
        exclusions:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          maxItems: 100
        trimRestrictions:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          maxItems: 100
        packageId:
          type: ["string", "null"]
          maxLength: 36
          format: uuid
        packageName:
          type: ["string", "null"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        packageDiscount:
          anyOf:
          - type: number
            format: double
          - type: "null"

    PricingType:
      type: string
      enum: [flat, percentage]
      description: >
        `flat` — dollar amount added to the quote.
        `percentage` — percentage of the base MSRP, calculated dynamically.

    # ── Quote Schemas ───────────────────────────────────────────────────────

    CreateQuoteRequest:
      type: object
      required: [vehicleId, trimId, customerName]
      properties:
        vehicleId:
          type: string
          maxLength: 36
          format: uuid
        trimId:
          type: string
          maxLength: 36
          format: uuid
        customerName:
          type: string
          examples: ["Jane Smith"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        expiresIn:
          type: integer
          default: 30
          description: >
            Number of days before a presented quote expires. If omitted,
            defaults to 30 days.

          format: int32
          minimum: 0
          maximum: 2147483647
    AddQuoteOptionRequest:
      type: object
      required: [optionId]
      properties:
        optionId:
          type: string
          description: ID of the option to add to the quote

          maxLength: 36
          format: uuid
    TransitionQuoteRequest:
      type: object
      required: [status]
      properties:
        status:
          $ref: "#/components/schemas/QuoteStatus"

    Quote:
      type: object
      required: [id, vehicleId, trimId, customerName, status, options, appliedIncentives, createdAt, updatedAt]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        vehicleId:
          type: string
          maxLength: 36
          format: uuid
        trimId:
          type: string
          maxLength: 36
          format: uuid
        customerName:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        status:
          $ref: "#/components/schemas/QuoteStatus"
        options:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          description: IDs of options currently on the quote
          maxItems: 100
        appliedIncentives:
          type: array
          items:
            type: string
            maxLength: 255
            pattern: ^[\s\S]*$
          description: IDs of incentive programs currently applied to the quote
          maxItems: 100
        expiresAt:
          type: ["string", "null"]
          format: date-time
          description: >
            Expiration timestamp, calculated from expiresIn when the quote
            transitions to presented status. Null while in draft status.
          maxLength: 40
        createdAt:
          type: string
          format: date-time
          maxLength: 40
        updatedAt:
          type: string
          format: date-time

          maxLength: 40
    QuoteStatus:
      type: string
      enum: [draft, presented, accepted, expired]
      description: >
        Quote lifecycle status. Valid transitions:
        draft → presented, presented → accepted, presented → expired.
        Only draft quotes can be modified (add/remove options).
        Accepted quotes cannot be reverted.

    QuotePricing:
      type: object
      required: [quoteId, baseMsrp, optionsTotal, packageDiscount, destinationCharge, totalPrice]
      properties:
        quoteId:
          type: string
          maxLength: 36
          format: uuid
        baseMsrp:
          type: number
          format: double
          description: MSRP of the selected trim level
        optionsTotal:
          type: number
          format: double
          description: Sum of all option prices (flat + calculated percentage)
        packageDiscount:
          type: number
          format: double
          description: >
            Total package discount amount (positive value, subtracted when
            computing `totalPrice`). Zero when no packages are fully present
            on the quote.
            Always present in the response (0 when no packages apply). This
            is an aggregated scalar total across all applicable packages. For
            an itemized per-package breakdown, see the `packageDiscounts` array
            in `PricingBreakdown` returned by `GET /quotes/{id}/pricing-breakdown`.
        destinationCharge:
          type: number
          format: double
          description: Flat destination charge for the vehicle model
        totalPrice:
          type: number
          format: double
          description: >
            Pre-incentive total for the quote: baseMsrp + optionsTotal -
            packageDiscount + destinationCharge. This value does not include
            any incentive discounts, even if incentives have been evaluated
            or applied to the quote. For the final customer price including
            all applied incentives, use the `finalPrice` field from the
            pricing breakdown returned by GET /quotes/{id}/pricing-breakdown.

    # ── Incentive Program Schemas ───────────────────────────────────────────

    CreateIncentiveProgramRequest:
      type: object
      required: [name, startDate, endDate, exclusive]
      properties:
        name:
          type: string
          examples: ["Summer Sales Event"]
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        description:
          type: string
          maxLength: 2000
          pattern: ^[\s\S]+$
        startDate:
          type: string
          format: date
          description: Program effective start date (inclusive)
          examples: ["2025-06-01"]
          maxLength: 10
        endDate:
          type: string
          format: date
          description: Program effective end date (inclusive)
          examples: ["2025-08-31"]
          maxLength: 10
        exclusive:
          type: boolean
          description: >
            If true, this program cannot stack with any other program. When
            multiple exclusive programs qualify, only the one producing the
            largest dollar discount is applied.
          default: false
        stackingCap:
          anyOf:
          - type: number
            format: double
          - type: "null"
          description: >
            Maximum aggregate discount that non-exclusive programs can apply,
            expressed as a percentage of the full quote total
            (baseMsrp + sum of option prices + destinationCharge, before any
            package discounts are deducted; e.g., 15.0 means 15%). Only
            relevant for non-exclusive programs. When omitted, this field is
            treated as `null`. If this value is null for a qualifying
            non-exclusive program, that program does not impose any stacking
            cap. When multiple qualifying non-exclusive programs define
            different non-null caps, the lowest (most restrictive) cap governs
            the aggregate discount limit. If no qualifying non-exclusive
            program specifies a non-null cap, no aggregate stacking cap is
            applied and non-exclusive discounts may stack without a percentage
            limit (subject to other program rules).
          examples: [15.0]

    IncentiveProgram:
      type: object
      required: [id, name, startDate, endDate, exclusive, stackingCap, rules, benefits]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        name:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        description:
          type: string
          maxLength: 2000
          pattern: ^[\s\S]+$
        startDate:
          type: string
          format: date
          maxLength: 10
        endDate:
          type: string
          format: date
          maxLength: 10
        exclusive:
          type: boolean
        stackingCap:
          anyOf:
          - type: number
            format: double
          - type: "null"
        rules:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/ProgramRule"
          maxItems: 100
        benefits:
          type: array
          default: []
          items:
            $ref: "#/components/schemas/ProgramBenefit"

          maxItems: 100
    CreateProgramRuleRequest:
      type: object
      required: [type]
      properties:
        type:
          $ref: "#/components/schemas/ProgramRuleType"
        parameters:
          description: >
            Rule-specific parameters. May be omitted for rule types that
            require no parameters (e.g., date_range uses the program's own
            startDate/endDate).
          default: {}
          allOf:
          - $ref: "#/components/schemas/ProgramRuleParameters"
      allOf:
      - if:
          required: [type]
          properties:
            type:
              const: vehicle_model
        then:
          required: [parameters]
          properties:
            parameters:
              required: [vehicleIds]
      - if:
          required: [type]
          properties:
            type:
              const: min_trim_level
        then:
          required: [parameters]
          properties:
            parameters:
              required: [minTrimLevel]
      - if:
          required: [type]
          properties:
            type:
              const: min_quote_total
        then:
          required: [parameters]
          properties:
            parameters:
              required: [minTotal]
      - if:
          required: [type]
          properties:
            type:
              const: option_included
        then:
          required: [parameters]
          properties:
            parameters:
              required: [optionId]
      - if:
          required: [type]
          properties:
            type:
              const: category_included
        then:
          required: [parameters]
          properties:
            parameters:
              required: [categoryId]

    ProgramRule:
      type: object
      required: [id, programId, type, parameters]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        programId:
          type: string
          maxLength: 36
          format: uuid
        type:
          $ref: "#/components/schemas/ProgramRuleType"
        parameters:
          $ref: "#/components/schemas/ProgramRuleParameters"

    ProgramRuleType:
      type: string
      enum:
      - vehicle_model
      - min_trim_level
      - min_quote_total
      - option_included
      - category_included
      - date_range
      description: >
        Rule types:

        - `vehicle_model` — Quote's vehicle must be in the specified list.
        - `min_trim_level` — Quote's trim level must be at or above the minimum.
        - `min_quote_total` — Quote's pre-incentive subtotal
          (`subtotalBeforeIncentives`) must exceed the threshold.
        - `option_included` — A specific option must be on the quote.
        - `category_included` — At least one option from the category must be on the quote.
        - `date_range` — Quote's `createdAt` timestamp must fall within the
          program's active date range. Eligibility is always evaluated against
          the quote's persisted `createdAt` value, not the current wall-clock
          time at the point of evaluation or incentive application. The comparison
          uses the date portion of `createdAt` in UTC (for example,
          `"2025-06-01T23:30:00-05:00"` is converted to `"2025-06-02T04:30:00Z"`
          and treated as date `"2025-06-02"` UTC) checked against the program's
          `startDate`/`endDate` bounds (both inclusive).

    ProgramRuleParameters:
      type: object
      description: >
        Parameters vary by rule type. Include only the fields relevant to the
        rule type. The `date_range` rule type requires no additional parameters
        here — it evaluates eligibility using the date portion of the quote's
        persisted `createdAt` timestamp in UTC against the program's own
        `startDate`/`endDate` fields (both bounds inclusive). The current
        evaluation or incentive application time is not used.
      properties:
        vehicleIds:
          type: array
          items:
            type: string
            maxLength: 36
            format: uuid
          description: "For `vehicle_model` rules: list of qualifying vehicle IDs"
          maxItems: 100
        minTrimLevel:
          type: integer
          description: >
            For `min_trim_level` rules: the minimum trim level value.
            The quote's trim level must be >= this value.
          examples: [2]
          format: int32
          minimum: 0
          maximum: 2147483647
        minTotal:
          type: number
          format: double
          description: >
            For `min_quote_total` rules: the quote's subtotal before incentives
            (`PricingBreakdown.subtotalBeforeIncentives` = baseMsrp + sum of
            option line item prices - sum of package discount amounts
            + destinationCharge) must be strictly greater than (>) this value.
          examples: [45000]
        optionId:
          type: string
          description: "For `option_included` rules: the required option ID"
          maxLength: 36
          format: uuid
        categoryId:
          type: string
          description: "For `category_included` rules: the required category ID"

          maxLength: 36
          format: uuid
    CreateProgramBenefitRequest:
      type: object
      required: [type, amount]
      properties:
        type:
          $ref: "#/components/schemas/ProgramBenefitType"
        amount:
          type: number
          format: double
          description: >
            For `flat_discount`: dollar amount (e.g., 2000).
            For `percentage_msrp`: percentage of base MSRP (e.g., 5.0 = 5%).
            For `percentage_category`: percentage off options in the category.
          examples: [2000]
        categoryId:
          type: ["string", "null"]
          description: >
            Required for `percentage_category` benefits. The category whose
            option prices are discounted.
          maxLength: 36
          format: uuid
      if:
        properties:
          type:
            const: percentage_category
        required: [type]
      then:
        required: [categoryId]
        properties:
          categoryId:
            type: string

            maxLength: 36
            format: uuid
    ProgramBenefit:
      type: object
      required: [id, programId, type, amount]
      properties:
        id:
          type: string
          maxLength: 36
          format: uuid
        programId:
          type: string
          maxLength: 36
          format: uuid
        type:
          $ref: "#/components/schemas/ProgramBenefitType"
        amount:
          type: number
          format: double
        categoryId:
          type: ["string", "null"]
          maxLength: 36
          format: uuid

    ProgramBenefitType:
      type: string
      enum:
      - flat_discount
      - percentage_msrp
      - percentage_category
      description: >
        Benefit types:

        - `flat_discount` — Flat dollar amount subtracted from the pre-incentive
          subtotal (`subtotalBeforeIncentives`).
        - `percentage_msrp` — Percentage discount off the base MSRP (not total).
        - `percentage_category` — Percentage discount off options in a specific category.

    # ── Incentive Evaluation Schemas ────────────────────────────────────────

    IncentiveEvaluation:
      type: object
      required: [quoteId, subtotalBeforeIncentives, eligiblePrograms, projectedBenefits, projectedDiscount, 
          projectedFinalPrice]
      properties:
        quoteId:
          type: string
          maxLength: 36
          format: uuid
        subtotalBeforeIncentives:
          type: number
          format: double
          description: >
            The quote's pre-incentive subtotal at the time of evaluation:
            baseMsrp + sum(options) - sum(packageDiscounts) + destinationCharge.
            Use this alongside `projectedDiscount` and `projectedFinalPrice` to
            present a complete "current price vs. price with incentives" view
            without requiring an additional call to POST /quotes/{id}/calculate.
        eligiblePrograms:
          type: array
          items:
            $ref: "#/components/schemas/EligibleProgram"
          description: All programs the quote currently qualifies for
          maxItems: 100
        projectedBenefits:
          type: array
          items:
            $ref: "#/components/schemas/AppliedIncentive"
          description: >
            Benefits that would actually be applied after stacking rules
            (one entry per benefit, not per program). Each entry's
            `discountAmount` represents the final, cap-adjusted amount
            that would be applied for that benefit. The sum of all
            `projectedBenefits[*].discountAmount` equals `projectedDiscount`.
            May differ from `eligiblePrograms` when exclusive rules or caps apply.
          maxItems: 100
        projectedDiscount:
          type: number
          format: double
          description: >
            Total discount amount that would be applied after all exclusivity
            and stacking caps are enforced (positive value, subtracted from
            `subtotalBeforeIncentives`). Equals the sum of all
            `projectedBenefits[*].discountAmount`.
        projectedFinalPrice:
          type: number
          format: double
          description: >
            Quote total after projected incentive discounts:
            `subtotalBeforeIncentives` - `projectedDiscount`.

    EligibleProgram:
      type: object
      required: [programId, programName, exclusive, computedDiscount]
      properties:
        programId:
          type: string
          maxLength: 36
          format: uuid
        programName:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        exclusive:
          type: boolean
        computedDiscount:
          type: number
          format: double
          description: >
            Total dollar discount this program would produce for the current
            quote state (positive value, subtracted from the pre-incentive
            subtotal; see `PricingBreakdown.subtotalBeforeIncentives`), aggregating
            the impact of all of its benefits. See `IncentiveEvaluation.projectedBenefits`
            for an itemized per-benefit breakdown.

    # ── Pricing Breakdown Schemas ───────────────────────────────────────────

    PricingBreakdown:
      type: object
      required:
      - quoteId
      - baseMsrp
      - options
      - packageDiscounts
      - destinationCharge
      - subtotalBeforeIncentives
      - appliedIncentives
      - totalIncentiveDiscount
      - finalPrice
      properties:
        quoteId:
          type: string
          maxLength: 36
          format: uuid
        baseMsrp:
          type: number
          format: double
          description: MSRP of the selected trim level
        options:
          type: array
          items:
            $ref: "#/components/schemas/PricingLineItem"
          description: Each option with its computed price
          maxItems: 100
        packageDiscounts:
          type: array
          items:
            $ref: "#/components/schemas/PackageDiscountLineItem"
          description: Package discounts applied (when all member options present)
          maxItems: 100
        destinationCharge:
          type: number
          format: double
        subtotalBeforeIncentives:
          type: number
          format: double
          description: >
            baseMsrp + sum(options) - sum(packageDiscounts) + destinationCharge
        appliedIncentives:
          type: array
          items:
            $ref: "#/components/schemas/AppliedIncentive"
          description: >
            Each applied incentive with its cap-adjusted discount amount.
            Each entry's `discountAmount` reflects the final amount after
            any stacking cap is applied. The sum of all
            `appliedIncentives[*].discountAmount` equals `totalIncentiveDiscount`.
          maxItems: 100
        totalIncentiveDiscount:
          type: number
          format: double
          description: >
            Sum of all applied incentive discounts (positive value,
            subtracted from subtotalBeforeIncentives)
        finalPrice:
          type: number
          format: double
          description: subtotalBeforeIncentives - totalIncentiveDiscount

    PricingLineItem:
      type: object
      required: [optionId, name, pricingType, price]
      properties:
        optionId:
          type: string
          maxLength: 36
          format: uuid
        name:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        pricingType:
          $ref: "#/components/schemas/PricingType"
        price:
          type: number
          format: double
          description: >
            Computed price. For percentage options, this is the calculated
            dollar amount based on the base MSRP.

    PackageDiscountLineItem:
      type: object
      required: [packageId, packageName, discount]
      properties:
        packageId:
          type: string
          maxLength: 36
          format: uuid
        packageName:
          type: string
          description: Human-readable name of the package
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        discount:
          type: number
          format: double
          description: >
            The dollar amount discounted for this package (positive value,
            subtracted when computing `subtotalBeforeIncentives`)

    AppliedIncentive:
      type: object
      description: >
        Represents a single applied benefit. A program with multiple benefit
        types produces one `AppliedIncentive` entry per benefit so that each
        discount can be itemized and traced back to its source program and type.
      required: [programId, programName, benefitType, discountAmount]
      properties:
        programId:
          type: string
          maxLength: 36
          format: uuid
        programName:
          type: string
          maxLength: 255
          pattern: ^[\w\s\-\.\'\"&,()]+$
        benefitType:
          $ref: "#/components/schemas/ProgramBenefitType"
        discountAmount:
          type: number
          format: double
          description: >
            Final, cap-adjusted dollar amount discounted by this benefit
            (positive value, subtracted from `subtotalBeforeIncentives`).
            When a non-exclusive stacking cap is applied across multiple
            stackable benefits, this value is pro-rated proportionally based
            on the benefit's raw (uncapped) discount amount: each benefit's
            `discountAmount` is computed as
            `rawDiscountAmount / sumOfAllRawDiscountAmounts × cappedTotalDiscount`,
            subject to normal currency rounding rules, rather than using the
            raw computed amount.
        categoryId:
          type: ["string", "null"]
          description: >
            For `percentage_category` benefits: the ID of the option category
            that was discounted. Null or absent for other benefit types.
          maxLength: 36
          format: uuid
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT Bearer token authentication. This API complies with RFC8725 for JWT best practices including 
        short-lived tokens and audience validation.
security:
- BearerAuth: []
